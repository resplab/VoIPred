<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Development EVPI tutorial • voipred</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Development EVPI tutorial">
<meta property="og:description" content="voipred">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">voipred</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/devEVPI_tutorial.html">Development EVPI tutorial</a>
    </li>
    <li>
      <a href="../articles/VoIPred_tutorial.html">Tutorial for VoIPred: Value of Information for risk prediciton models</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Development EVPI tutorial</h1>
                        <h4 data-toc-skip class="author">Mohsen Sadatsafavi</h4>
            
            <h4 data-toc-skip class="date">2/5/2022</h4>
      
      
      <div class="hidden name"><code>devEVPI_tutorial.Rmd</code></div>

    </div>

    
    
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>This tutorial is a step-by-step calculation of the Expected Value of Perfect Information (EVPI) for risk prediction model.</p>
<p>To keep things simple, we use the small and simple data set birthwt from the MASS package. These data are for the new born and were collected at Baystate Medical Center, Springfield, Mass during 1986.</p>
<p>Our outcome of interest is the binary variable ‘low’, taking a value of 1 if the baby’s weight is too low (&lt;2.5Kg). We use the following 3 predictors:</p>
<p>age: mother’s age in years.</p>
<p>lwt: mother’s weight in pounds at last menstrual period.</p>
<p>smoke: smoking status during pregnancy.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">'birthwt'</span>, package<span class="op">=</span><span class="st">"MASS"</span><span class="op">)</span></code></pre></div>
<p>The data has 59 rows. The outcome was observed in 59 births.</p>
<p>Because we are working with a subset of data, we keep a clean, targetted dataset that we call dev_data (development data).</p>
<p>Also, the risk threshold of interest is 0.2.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dev_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">birthwt</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'age'</span>,<span class="st">'lwt'</span>,<span class="st">'smoke'</span><span class="op">)</span><span class="op">]</span>, Y<span class="op">=</span><span class="va">birthwt</span><span class="op">$</span><span class="va">low</span><span class="op">)</span>

<span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">dev_data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="co">#n is the number of observations.</span>
<span class="va">z</span> <span class="op">&lt;-</span> <span class="fl">0.2</span> <span class="co">#this is the risk threshold.</span></code></pre></div>
<p>This is how the data looks like:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dev_data</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    age lwt smoke Y</span>
<span class="co">## 85  19 182     0 0</span>
<span class="co">## 86  33 155     0 0</span>
<span class="co">## 87  20 105     1 0</span>
<span class="co">## 88  21 108     1 0</span>
<span class="co">## 89  18 107     1 0</span>
<span class="co">## 91  21 124     0 0</span></code></pre>
</div>
<div class="section level3">
<h3 id="our-proposed-model">Our ‘proposed’ model<a class="anchor" aria-label="anchor" href="#our-proposed-model"></a>
</h3>
<p>To proceed, we fit an uncomplicated logistic regression model:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">lwt</span> <span class="op">+</span> <span class="va">smoke</span>, data<span class="op">=</span><span class="va">dev_data</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>And this is a summary of this proposed model:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## Call:  glm(formula = Y ~ age + lwt + smoke, family = binomial(link = "logit"), </span>
<span class="co">##     data = dev_data)</span>
<span class="co">## </span>
<span class="co">## Coefficients:</span>
<span class="co">## (Intercept)          age          lwt        smoke  </span>
<span class="co">##     1.36823     -0.03899     -0.01214      0.67076  </span>
<span class="co">## </span>
<span class="co">## Degrees of Freedom: 188 Total (i.e. Null);  185 Residual</span>
<span class="co">## Null Deviance:       234.7 </span>
<span class="co">## Residual Deviance: 222.9     AIC: 230.9</span></code></pre>
<p>Let’s go ahead and calculate the predicted risks (pred) for each patients:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dev_data</span><span class="op">$</span><span class="va">pi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>,type<span class="op">=</span><span class="st">'response'</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dev_data</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    age lwt smoke Y        pi</span>
<span class="co">## 85  19 182     0 0 0.1705285</span>
<span class="co">## 86  33 155     0 0 0.1418425</span>
<span class="co">## 87  20 105     1 0 0.4961377</span>
<span class="co">## 88  21 108     1 0 0.4773007</span>
<span class="co">## 89  18 107     1 0 0.5095645</span>
<span class="co">## 91  21 124     0 0 0.2777118</span></code></pre>
</div>
<div class="section level3">
<h3 id="the-net-benefit-of-this-model">The net benefit of this model<a class="anchor" aria-label="anchor" href="#the-net-benefit-of-this-model"></a>
</h3>
<p>Our metric of interest is Net Benefit (NB). At risk threshold of z, it is calculated as</p>
<p><span class="math inline">\(P(True positive) - P(False positive)\frac{z}{1-z}\)</span></p>
<p>Which in the sample can be estimated as</p>
<p><span class="math inline">\(NB(z)=\sum_{i=1}^nI(π_i&gt;z)\{Y_i-(1-Y_i)\frac{z}{1-z}\}\)</span></p>
<p>Which translates to the following code:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">z</span> <span class="op">&lt;-</span> <span class="fl">0.2</span>

<span class="va">NB_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">dev_data</span><span class="op">$</span><span class="va">pi</span><span class="op">&gt;</span><span class="va">z</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">dev_data</span><span class="op">$</span><span class="va">Y</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">dev_data</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span><span class="op">*</span><span class="va">z</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">NB_model</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 0.1574074</span></code></pre>
</div>
<div class="section level3">
<h3 id="uncertainty-in-risk-prediction">Uncertainty in risk prediction<a class="anchor" aria-label="anchor" href="#uncertainty-in-risk-prediction"></a>
</h3>
<p>Because the sample size is finite (and in fact quite small in this example), regression coefficients are uncertain. Our model is therefore likely different from the ‘correct model’; that is, the model with correct coefficients.</p>
<p>Because of this discrepancy, the use of the proposed model will be sub-optimal compared with the use of the correct model. As such, making decisions about patient management based on predicted risks from the proposed model can be different from the decision based on the correct risks.</p>
<p>The EVPI captures the expected loss in NB because of not knowing the correct risks.</p>
</div>
<div class="section level3">
<h3 id="nb-calculations-if-the-correct-model-is-known">NB calculations if the correct model is known<a class="anchor" aria-label="anchor" href="#nb-calculations-if-the-correct-model-is-known"></a>
</h3>
<p>Imagine for the moment, we know the truth: that the correct model associating our predictors of interest to the risk of the outcome if of the form</p>
<p><span class="math inline">\(logit(P(Y))= 1 - 0.03899*age - 0.01*lwt + 0.5*smoke\)</span></p>
<p>Because we know the truth, we can calculate the actual risk of outcome, denoted by p, for each observation in the data set:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dev_data</span><span class="op">$</span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fl">0.03899</span><span class="op">*</span><span class="va">dev_data</span><span class="op">$</span><span class="va">age</span><span class="op">-</span><span class="fl">0.01</span><span class="op">*</span><span class="va">dev_data</span><span class="op">$</span><span class="va">lwt</span><span class="op">+</span><span class="fl">0.5</span><span class="op">*</span><span class="va">dev_data</span><span class="op">$</span><span class="va">smoke</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now our data looks like</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dev_data</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    age lwt smoke Y        pi         p</span>
<span class="co">## 85  19 182     0 0 0.1705285 0.1735304</span>
<span class="co">## 86  33 155     0 0 0.1418425 0.1374456</span>
<span class="co">## 87  20 105     1 0 0.4961377 0.4182893</span>
<span class="co">## 88  21 108     1 0 0.4773007 0.4016031</span>
<span class="co">## 89  18 107     1 0 0.5095645 0.4324603</span>
<span class="co">## 91  21 124     0 0 0.2777118 0.2575408</span></code></pre>
<p>Now that we have the correct risks, we can calculate the net benefit directly using p:</p>
<p><span class="math inline">\(NB(z)=\sum_{i=1}^n I(π_i&gt;z)(p_i-(1-p_i)\frac{z}{1-z})\)</span></p>
<p>This is very similar to the original euqation for NB, only that we have replaced Y with correct probabilities. Implementing this in R, we have</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">NB_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">dev_data</span><span class="op">$</span><span class="va">pi</span><span class="op">&gt;</span><span class="va">z</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">dev_data</span><span class="op">$</span><span class="va">p</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">dev_data</span><span class="op">$</span><span class="va">p</span><span class="op">)</span><span class="op">*</span><span class="va">z</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">NB_model</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 0.1073516</span></code></pre>
<p>We similarly calculate the NB of treating all:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">NB_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">dev_data</span><span class="op">$</span><span class="va">p</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">dev_data</span><span class="op">$</span><span class="va">p</span><span class="op">)</span><span class="op">*</span><span class="va">z</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">NB_all</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 0.09654724</span></code></pre>
</div>
<div class="section level3">
<h3 id="nb-of-the-correct-model-itself-nb_max">NB of the correct model itself (<span class="math inline">\(NB_max\)</span>)<a class="anchor" aria-label="anchor" href="#nb-of-the-correct-model-itself-nb_max"></a>
</h3>
<p>If we know the correct model, then why even using our proposed model? We can calculate the NB of the correct model</p>
<p><span class="math inline">\(NB_{max}(z)= \sum_{i=1}^n I(p_i&gt;z)(p_i-(1-p_i)\frac{z}{1-z})\)</span></p>
<p>Which is easy to calculate:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">NB_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">dev_data</span><span class="op">$</span><span class="va">p</span><span class="op">&gt;</span><span class="va">z</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">dev_data</span><span class="op">$</span><span class="va">p</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">dev_data</span><span class="op">$</span><span class="va">p</span><span class="op">)</span><span class="op">*</span><span class="va">z</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">NB_max</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 0.1076502</span></code></pre>
</div>
<div class="section level3">
<h3 id="a-bayesian-approach-to-nb-calculation">A Bayesian approach to NB calculation<a class="anchor" aria-label="anchor" href="#a-bayesian-approach-to-nb-calculation"></a>
</h3>
<p>The above calculations was based on the complete knowledge about the correct model. However, we do now know the correct model! How should we proceed?</p>
<p>This requires a Bayesian approach towards NB calculations. We treat the parameters of the correct model as random variables, let’s call them θ, and assume we know aboue their distirbution via P(Θ).</p>
<p>Then, we can calculate the expected value of NBs as</p>
<p><span class="math inline">\(\text{E}NB_{model}=\text{E}_θNB_{model}(Θ;z)\)</span> <span class="math inline">\(\text{E}NB_{all}=\text{E}_θNB_{all}(Θ;z)\)</span> <span class="math inline">\(\text{E}NB_{max}=\text{E}_θNB_{max}(Θ;z)\)</span></p>
<p>The algorithm looks like this: 1. Sample from the P(Θ). This sample can be taken as the truth for the moment. 2. Calculate the NB of your model, NB of treating all, and NB of using this correct model. Store the results in memory 3. Repeat steps 1-2 many times. 4. Average the results.</p>
<div class="section level4">
<h4 id="bootstrap-for-sampling-from-the-posterior-distribution-of-the-correct-risks">Bootstrap for sampling from the posterior distribution of the correct risks<a class="anchor" aria-label="anchor" href="#bootstrap-for-sampling-from-the-posterior-distribution-of-the-correct-risks"></a>
</h4>
<p>The big question is indeed how to sample from the parameters of the correct model. A straightforward approach is to use bootstrapping: We bootstrap the dataset, and fit a new model. We make predction from this model to the original data set. This will a sample from the correct risks:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">NB_model</span> <span class="op">&lt;-</span> <span class="va">NB_max</span> <span class="op">&lt;-</span> <span class="va">NB_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1000</span><span class="op">)</span>
<span class="op">{</span>
  <span class="va">bs_data</span> <span class="op">&lt;-</span> <span class="va">dev_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, size <span class="op">=</span> <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,<span class="op">]</span>
  <span class="va">bs_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">lwt</span> <span class="op">+</span> <span class="va">smoke</span>, data<span class="op">=</span><span class="va">bs_data</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">bs_model</span>, newdata <span class="op">=</span> <span class="va">dev_data</span>, type<span class="op">=</span><span class="st">'response'</span><span class="op">)</span>
  
  <span class="va">NB_model</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">dev_data</span><span class="op">$</span><span class="va">pi</span><span class="op">&gt;</span><span class="va">z</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">p</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p</span><span class="op">)</span><span class="op">*</span><span class="va">z</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">NB_all</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">p</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p</span><span class="op">)</span><span class="op">*</span><span class="va">z</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="va">NB_max</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">p</span><span class="op">&gt;</span><span class="va">z</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">p</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p</span><span class="op">)</span><span class="op">*</span><span class="va">z</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Let’s look at how these quantities are distirbuted:</p>
<p><img src="devEVPI_tutorial_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="calculating-evpi">Calculating EVPI<a class="anchor" aria-label="anchor" href="#calculating-evpi"></a>
</h4>
<p>Now we can calculate EVPI:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ENB_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">NB_model</span><span class="op">)</span>
<span class="va">ENB_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">NB_all</span><span class="op">)</span>
<span class="va">ENB_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">NB_max</span><span class="op">)</span>

<span class="va">EVPI</span> <span class="op">&lt;-</span> <span class="va">ENB_max</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">ENB_model</span>,<span class="va">ENB_all</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="va">EVPI</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## 0.00500095853237353</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="putting-things-together-r-code-for-evpi-calculation">Putting things together: R code for EVPI calculation<a class="anchor" aria-label="anchor" href="#putting-things-together-r-code-for-evpi-calculation"></a>
</h3>
<p>The code below consolidates everything, and also does the calculations for a range of threshold:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">dev_data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="va">z</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">99</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>
<span class="va">n_sim</span> <span class="op">&lt;-</span> <span class="fl">1000</span>

<span class="va">dev_data</span><span class="op">$</span><span class="va">pi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span> <span class="co">#Predicted risks</span>

<span class="co">#Step 2:</span>
<span class="va">NB_model</span> <span class="op">&lt;-</span> <span class="va">NB_all</span> <span class="op">&lt;-</span> <span class="va">NB_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_sim</span><span class="op">)</span> 
<span class="op">{</span>
  <span class="co">#Step 2.1</span>
  <span class="va">bs_data</span> <span class="op">&lt;-</span>  <span class="va">dev_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,<span class="op">]</span> 
  <span class="va">bs_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">lwt</span> <span class="op">+</span> <span class="va">smoke</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span>, data<span class="op">=</span><span class="va">bs_data</span><span class="op">)</span>
  <span class="co">#Step 2.2</span>
  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">bs_model</span>, newdata <span class="op">=</span>  <span class="va">dev_data</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span> <span class="co">#draw from correct risks   </span>
  <span class="co">#Step 2.3 </span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span>
  <span class="op">{</span>
    <span class="va">NB_all</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">NB_all</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">p</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">z</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">z</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="va">n_sim</span> <span class="co">#NB of treating all</span>
    <span class="va">NB_model</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">NB_model</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">dev_data</span><span class="op">$</span><span class="va">pi</span><span class="op">&gt;</span><span class="va">z</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">p</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p</span><span class="op">)</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">z</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="va">n_sim</span> <span class="co">#NB of using the model</span>
    <span class="va">NB_max</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">NB_max</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">p</span><span class="op">&gt;</span><span class="va">z</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">p</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p</span><span class="op">)</span><span class="op">*</span><span class="va">z</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">z</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="va">n_sim</span> <span class="co">#NB of using the correct risks</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="co">#Step 4</span>
<span class="va">EVPI</span> <span class="op">&lt;-</span> <span class="va">NB_max</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">NB_model</span>,<span class="va">NB_all</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">z</span>, <span class="va">EVPI</span>, xlab<span class="op">=</span><span class="st">"Threshold"</span>, ylab<span class="op">=</span><span class="st">"EVPI"</span>, type<span class="op">=</span><span class="st">'l'</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></code></pre></div>
<p><img src="devEVPI_tutorial_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="how-to-interpret-evpi">How to interpret EVPI?<a class="anchor" aria-label="anchor" href="#how-to-interpret-evpi"></a>
</h3>
<p>EVPI is in the true positive scale. This is rather context-specific. We think EVPI can best be interpreted compared to the NB that the proposed model provides. To this end, we propose Incremental NB and Relative EVPI.</p>
<p>To proceed, we note that we have three Nb entities to compare: - NB of the best decision without any risk stratification: <span class="math inline">\(max(0,\text{E}NB_{all})\)</span> - NB of the best decision with the proposed model: <span class="math inline">\(max(0,\text{E}NB_{all},\text{E}NB_{model})\)</span> - NB of the best decision with the correct model: <span class="math inline">\(NB_{max}\)</span></p>
<p>So, the Incremental Benefit (ΔNB) with current information is <span class="math inline">\(\text{E}INB_\text{Current Information}=max(0,\text{E}NB_{all},\text{E}NB_{model}) - max(0,\text{E}NB_{all})\)</span></p>
<p>Where is with perfect information it is: <span class="math inline">\(\text{E}INB_\text{Perfect Information}=NB_{max}-max(0,\text{E}NB_{all})\)</span></p>
<p>Which can be calculated as</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">INB_current</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">NB_model</span>,<span class="va">NB_all</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">NB_all</span><span class="op">)</span>
<span class="va">INB_perfect</span> <span class="op">&lt;-</span> <span class="va">NB_max</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">NB_all</span><span class="op">)</span></code></pre></div>
<p>Our suggestion for the graphical presentation is an overlay of the two INB plots:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">z</span>, <span class="va">INB_current</span>, type<span class="op">=</span><span class="st">'l'</span>, col<span class="op">=</span><span class="st">'black'</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">INB_current</span>,<span class="va">INB_perfect</span><span class="op">)</span><span class="op">)</span>, xlab<span class="op">=</span><span class="st">"Threshold"</span>, ylab<span class="op">=</span><span class="st">"Incremental NB"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">z</span>,<span class="va">NB_max</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">NB_all</span><span class="op">)</span>,type<span class="op">=</span><span class="st">'l'</span>, col<span class="op">=</span><span class="st">'red'</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">INB_current</span>,<span class="va">INB_perfect</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="devEVPI_tutorial_files/figure-html/unnamed-chunk-18-1.png" width="700"> Which nicely shows the difference between the INB curves across the thresholds. This difference is the EVPI, and this graphs shows its extent compared with the gain in NB with the proposed model.</p>
<p>As well, we suggest taking the ratio of the two, which we call Relative EVPI (EVPIr):</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">EVPIr</span> <span class="op">&lt;-</span> <span class="va">INB_perfect</span><span class="op">/</span><span class="va">INB_current</span></code></pre></div>
<p>However, a simple plot of this graph might not be very informative (especially with small samples like ours):</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">z</span>, <span class="va">EVPIr</span>, type<span class="op">=</span><span class="st">'l'</span>, xlab<span class="op">=</span><span class="st">"Threshold"</span>, ylab<span class="op">=</span><span class="st">"Relative EVPI"</span><span class="op">)</span></code></pre></div>
<p><img src="devEVPI_tutorial_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>This is indeed a messy, uninformative graph, and the reason is obvious in the INB graph: in many instances, the INB under current information, the denominator, is 0. If INB under perfect information is 0 (like around threshold value of XXX) we will get 0/0 NaN. If INB under perfect information is non-zero, with get +∞. These have two different meanings:</p>
<ul>
<li><p>An EVPIr of 0/0 means under perfect (and thus correct) information, the model is not expected to do better than the default decisions.</p></li>
<li><p>An EVPIr of +∞ means that while under current information the model is not expected to do better than default decisions, under perfect information it might! Thus the model is not good to go towards validation. But procuring more development sample and revising the model might be justified.</p></li>
</ul>
<p>The EVPIr graph can therefore be upgraded to accomodate these. We cap it on the Y-axis at 10 (to us, an EVPIr of &gt;10 has the same implications as an EVPIr=+∞). We also label the areas of the X-axis according to whether EVPIr is 0/0 or +∞.</p>
<p>So we do a little processing to identify the areas where EVPIr is 0/0 versus +∞:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">max_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">EVPIr</span>,na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,<span class="fl">10</span><span class="op">)</span>
<span class="va">yNaN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span>
<span class="va">yNaN</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.nan</a></span><span class="op">(</span><span class="va">EVPIr</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">yInf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span>
<span class="va">yInf</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">EVPIr</span><span class="op">&gt;</span><span class="fl">10</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">z</span>, <span class="va">EVPIr</span>, type<span class="op">=</span><span class="st">'l'</span>, col<span class="op">=</span><span class="st">'red'</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">max_y</span><span class="op">)</span>, xlab<span class="op">=</span><span class="st">"Threshold"</span>, ylab<span class="op">=</span><span class="st">"Relative EVPI"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>new<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">yNaN</span>, <span class="va">w</span>, border<span class="op">=</span><span class="st">'grey'</span>, col<span class="op">=</span><span class="st">'grey'</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">max_y</span><span class="op">)</span>, xlab<span class="op">=</span><span class="cn">NULL</span>, ylab<span class="op">=</span><span class="cn">NULL</span>, space<span class="op">=</span><span class="fl">0</span>, axes<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>new<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">yInf</span>, <span class="va">w</span>, border<span class="op">=</span><span class="st">'black'</span>, col<span class="op">=</span><span class="st">'black'</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">max_y</span><span class="op">)</span>, xlab<span class="op">=</span><span class="cn">NULL</span>, ylab<span class="op">=</span><span class="cn">NULL</span>, space<span class="op">=</span><span class="fl">0</span>, axes<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="fl">0.8</span>,<span class="fl">9</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0/0"</span>,<span class="st">"&gt;10"</span><span class="op">)</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey"</span>,<span class="st">"black"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">10</span><span class="op">)</span>, border<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></code></pre></div>
<p><img src="devEVPI_tutorial_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Mohsen Sadatsafavi.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
